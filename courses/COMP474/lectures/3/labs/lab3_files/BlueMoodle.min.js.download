function BlueMoodleOnload(){var u,n,f,e,h,t,c,r,l,o,s;if((localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)=="null"||localStorage.getItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE)==undefined)&&window.location.href.toLowerCase().indexOf("login/index.php")==-1&&window.location.href.toLowerCase().indexOf("login.php")==-1){if(u=!1,f=document.getElementsByClassName("logininfo"),f!=null&&f!="")for(i=0;i<f.length;i++)if(e=f[i].getElementsByTagName("a"),e!=null&&e!="")for(j=0;j<e.length;j++)if(h=e[j].href,h.indexOf("profile")>-1){n=h.split("=")[1];localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);u=!0;break}if(!u&&(t=document.querySelectorAll("a[href*='profile.php']"),t!=null&&t.length>0))for(i=0;i<t.length;i++)if(t[i].href!=null&&t[i].href!=""&&(n=BLUE_MOODLE.getQueryString("id",t[i].href),n!=null&&n!="")){localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);u=!0;break}if(!u&&(t=document.querySelectorAll("*[data-userid]"),t!=null&&t.length>0))for(i=0;i<t.length;i++)if(n=t[i].getAttribute("data-userid"),n!=null&&n!=""){localStorage.setItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE,n);u=!0;break}u&&n!=null&&n!=""&&n!=undefined?(localStorage.setItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE,!0),c=document.getElementsByTagName("html")[0].getAttribute("lang"),r=new XMLHttpRequest,r.onreadystatechange=function(){var i,o,f,s,y,h;if(r.readyState==4&&r.status==200){var n=JSON.parse(r.response),l=!1,u=[],e=[];if(n.MoodleSeriousTaskList!=null&&n.MoodleSeriousTaskList.length>0&&(u=n.MoodleSeriousTaskList,localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE,JSON.stringify(u))),n.MoodleCourseDetails!=null&&n.MoodleCourseDetails.length>0&&(e=n.MoodleCourseDetails,localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_DETAILS_MOODLE,JSON.stringify(e))),n.MoodleCustomAdminSettingDetails!=null&&localStorage.setItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE,JSON.stringify(n.MoodleCustomAdminSettingDetails)),n.MoodleCourseToolDetailList!=null&&n.MoodleCourseToolDetailList.length>0&&localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE,JSON.stringify(n.MoodleCourseToolDetailList)),i=BLUE_MOODLE.GetAdminSettingFromLocal(),i!=null&&i.IsLoginPrompt=="YES"&&1){var t={Ids:[],PopUpList:[]},a=!1,v=!1;if(u.length>0){l=!0;function p(r){for(var s,h,l,y=!1,f=0;f<t.Ids.length;f++)if(r.CourseID==t.Ids[f]){y=!0;break}if(!y){for(t.Ids.push(r.CourseID),s=[],f=0;f<e.length;f++)if(e[f].id==r.CourseID){s.push(e[f]);break}for(h=[],f=0;f<u.length;f++)u[f].CourseID==r.CourseID&&h.push(new Date(u[f].DueDate));if(l="",n.MoodleCourseToolDetailList!=null&&n.MoodleCourseToolDetailList.length>0)for(f=0;f<n.MoodleCourseToolDetailList.length;f++)if(n.MoodleCourseToolDetailList[f].CourseId==r.CourseID){l=n.MoodleCourseToolDetailList[f].ToolUrl;break}var o={CourseId:r.CourseID,Course:s,ToolUrl:l,DueDates:h},w=new Date(Math.min.apply(null,o.DueDates)),p=w.toLocaleDateString(c,BLUE_MOODLE.localConstant.DATE_FORMAT);o.Course.length>0?t.PopUpList.push({CourseName:o.Course[0].fullname,ToolUrl:o.ToolUrl,DueDate:p,CourseID:o.Course[0].id}):!a&&i.UserLevelTasks&&(a=!0,t.PopUpList.push({CourseName:i.OtherTaskLabel,ToolUrl:o.ToolUrl,DueDate:p,CourseID:"0"}));r.TaskType!="FO"&&(v=!0)}}u.forEach(p)}if(l&&t.PopUpList.length>0){if(o="",t.PopUpList.length>0){for(o+='<table style="font-size:13px;width:100%" role="presentation">',f=0;f<t.PopUpList.length;f++)o+='<tr><td style="width:250px;"><a style="cursor:pointer;color:#0099b6;text-decoration:underline;" href="#" title="'+t.PopUpList[f].CourseName+'" onclick="BLUE_MOODLE.PopUpCourseClick(\''+t.PopUpList[f].ToolUrl+"');\" >"+t.PopUpList[f].CourseName+'<\/a><\/td><td style="text-align:right;"> '+i.DueLabel+" "+t.PopUpList[f].DueDate+"<\/td><\/tr>";o+="<\/table>"}s="";t.PopUpList.length>0&&(s+='<div style="text-align:right;">',s+='<input type="button" value="'+i.LoginButtonLabel+'" title="'+i.LoginButtonLabel+'" style="white-space: normal;" onclick="BLUE_MOODLE.ClosePopup();"  id="btnPendingOk"  />',s+="<\/div>");y=BLUE_MOODLE.CommonPopUp("dvInner_SeriousTask",i.LogoURL,v?i.QPSVMHeaderText:i.LoginMessage,s,o);h=document.createElement("div");h.id="dvBlueLoginTasks";h.innerHTML=y;document.body.appendChild(h);BLUE_MOODLE.SetfocusOnPopup();BLUE_MOODLE.AddLogoutEvents()}}}},r.open("GET",BLUE_MOODLE_SETUP.appAPI+"/api/Moodle/GetBlueAdminSetting?userId="+n+"&language="+c+"&isLoginPopup=true",!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("CONSUMERID",BLUE_MOODLE_SETUP.consumerID),r.send()):BLUE_MOODLE.ClearLocalStorage()}window.location.href.indexOf(BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id=")>-1||window.location.href.indexOf(BLUE_MOODLE_SETUP.moodleAPI+"/mod/lti/view.php?id=")>-1?(l=BLUE_MOODLE.GetAdminSettingFromLocal(),l!=null&&l.GradeCourseBlockType=="CB"&&(localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)==""?localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE,BLUE_MOODLE.getParameter("id")):BLUE_MOODLE.getParameter("id")!=localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE)&&(localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE),localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE,BLUE_MOODLE.getParameter("id"))),localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE)==""?(localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)==undefined||localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)==null||localStorage.getItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE)=="")&&(localStorage.setItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE,!0),o=BLUE_MOODLE.CreateCourseBlockPopup(),localStorage.setItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE,o),window.location.href.indexOf(BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id=")>-1&&(s=document.createElement("div"),s.id="dvBlueCourseTasks",s.innerHTML=o,document.body.appendChild(s),BLUE_MOODLE.SetfocusOnPopup(),BLUE_MOODLE.AddLogoutEvents()),o!=""&&BLUE_MOODLE.BlockOtherLinksInCourse()):(BLUE_MOODLE.BlockOtherLinksInCourse(),BLUE_MOODLE.DisableOnClickInternal(!0)))):(localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.USER_IN_COURSE_MOODLE),localStorage.removeItem(BLUE_MOODLE.localConstant.CURRENT_COURSEORTOOL_ID_MOODLE));BLUE_MOODLE.AddLogoutEvents()}var BLUE_MOODLE={localConstant:{IS_USER_LOGEDIN_MOODLE:"isUserLoggedInMoodle",COURSE_TASK_LIST_MOODLE:"courseTaskListMoodle",COURSE_DETAILS_MOODLE:"courseDetailsMoodle",CUSTOM_SETTINGS_DETAILS_MOODLE:"customSettingsDetailsMoodle",USER_DETAILS_MOODLE:"userDetailsMoodle",COURSE_BLOCKPOPUP_MOODLE:"courseBlockPopupMoodle",COURSE_TOOLDETAIL_LIST_MOODLE:"courseToolDetailListMoodle",CURRENT_COURSEORTOOL_ID_MOODLE:"currentcCourseOrToolIdMoodle",USER_IN_COURSE_MOODLE:"userInCourseMoodle",CURRENT_COURSEID_MOODLE:"currentCourseIdMoodle",DATE_FORMAT:{year:"numeric",month:"long",day:"numeric"}},ClearLocalStorage:function(){localStorage.removeItem(BLUE_MOODLE.localConstant.IS_USER_LOGEDIN_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_TASK_LIST_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_DETAILS_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE);localStorage.removeItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)},GetAdminSettingFromLocal:function(){return JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.CUSTOM_SETTINGS_DETAILS_MOODLE))},getParameter:function(n){for(var i,r=window.location.search.substr(1).split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return decodeURIComponent(i[1]);return!1},SetfocusOnPopup:function(){window.setTimeout("document.getElementById('bluePopupHeading').focus();",500)},CommonPopUp:function(n,t,i,r,u){var f="";return(t==null||t=="")&&(t=BLUE_MOODLE_SETUP.appAPI+"/Content/explorance-university.png"),f+='<div id="dvOuter" style="position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.6); z-index: 1000; width: 100%; height: 100%;" role="dialog">',f+="<div id="+n+' style="position: relative; top: 25%; margin:auto; height: auto; max-width: 450px; width:auto; z-index: 10; background: #fff; border-top: 3px solid rgb(0, 153, 182); box-shadow: 0px 2px 6px rgba(0,0,0,1);" role="document" aria-live="assertive">',f+='<div style="padding: 0.5%; padding-bottom: 0;">',f+='<div style="text-align: center; box-shadow: lightGray 0px 1px; "><img height="72px" alt="Institution Logo Image" src='+t+' style="max-width:100%;" /><\/div>',f+='<h4 id="bluePopupHeading" style="padding: 10px;color: #444;font-size:13px; box-shadow: lightGray 0px 1px;text-align:center;" tabindex="0"><strong>'+i+"<\/strong><\/h4>",f+='<div style="padding:10px; max-height: 150px;overflow-y: auto;overflow-x: hidden;">',f+=u,f+="<\/div>",f+="<\/div>",f+='<div style="padding: 10px; background-color: #efede3; text-align: center">',f+=r,f+="<\/div>",f+="<\/div>",f+"<\/div>"},ClosePopup:function(n){var t;n!=undefined&&n!=null&&n!=""?(t=document.getElementById(n),t.parentNode.removeChild(t)):(t=document.getElementById("dvOuter"),t.parentNode.removeChild(t))},CloseCoursePopup:function(){setTimeout("window.location.href = BLUE_MOODLE_SETUP.moodleAPI;",100)},ShowLoader:function(n){var r="Checking for incomplete evaluations",t,i;n=="admin"&&(r="Loading admin settings");t="";t+="<style> ";t+="#dvCanvasLoader {position: fixed;    top: 0;\tleft: 0;width: 100%;height: 100%;background: rgba(0,0,0,0.5);z-index:999999;} ";t+=".loaderMsg {width: 300px;\tposition: relative;overflow: hidden;left: 40%;top: 40%;text-align: center;font-size: 14px;color: #fff;font-family: Verdana, Geneva, sans-serif;} ";t+="@media screen and (-webkit-min-device-pixel-ratio:0){  .spinner div { width: 20px;height: 20px;position: absolute;left: -20px;top: 310px !important;background-color: #fff;border-radius: 50%;animation: move 4s infinite cubic-bezier(.2, .64, .81, .23);z-index: 9999; }} ";t+=".spinner div{width: 20px;\theight: 20px;position: absolute;left: -20px;top: 280px;background-color: #fff;border-radius: 50%;animation: move 4s infinite cubic-bezier(.2, .64, .81, .23);z-index: 9999;}";t+=".spinner div:nth-child(2){animation-delay: 100ms;}";t+=".spinner div:nth-child(3){animation-delay: 200ms;}";t+=".spinner div:nth-child(4){animation-delay: 300ms;}";t+="@keyframes move { 0% {left: 0%;} 75% {left:100%;} 100% {left:100%;}}";t+="<\/style>";t+='<div id="dvCanvasLoader"><div class="loaderMsg">'+r+"<\/div>";t+='<div class="spinner"><div><\/div><div><\/div><div><\/div><div><\/div><\/div>';t+="<\/div>";i=document.createElement("div");i.id="dvBlueLoader";i.innerHTML=t;document.body.appendChild(i)},HideLoader:function(){var n=document.getElementById("dvCanvasLoader");n!=null&&n!=""&&n.parentNode.removeChild(n)},NavigateToTask:function(n){var t='<div role="main"><iframe allowfullscreen="true" style="min-height: 650px;width:100%;" class="tool_launch" id="tool_content" mozallowfullscreen="true" name="tool_content" src="'+n+'" tabindex="0" title="Tool Content" webkitallowfullscreen="true"><\/iframe><\/div>';document.getElementById("region-main")!=null&&document.getElementById("region-main")!=""&&(document.getElementById("block-region-side-pre")!=null&&document.getElementById("block-region-side-pre")!=""&&(document.getElementById("block-region-side-pre").style.width="25%"),document.getElementById("page-content")!=null&&document.getElementById("page-content")!=""&&(document.getElementById("page-content").style.width="100%"),document.getElementById("region-main-box")!=null&&document.getElementById("region-main-box")!=""&&(document.getElementById("region-main-box").style.width="100%"),document.getElementById("region-bs-main-and-pre")!=null&&document.getElementById("region-bs-main-and-pre")!=""&&(document.getElementById("region-bs-main-and-pre").style.width="100%"),document.getElementById("block-region-side-post")!=null&&document.getElementById("block-region-side-post")!=""&&(document.getElementById("block-region-side-post").style.display="none"),document.getElementById("region-main").style.width="74%",document.getElementById("region-main").innerHTML=t);BLUE_MOODLE.ClosePopup("dvOuter")},PopUpCourseClick:function(n){window.location.href=n},AddLogoutEvents:function(){var r=document.getElementsByClassName("usermenu"),t,n;if(r!=null&&r.length>0&&(n=r[0].getElementsByTagName("a"),n!=null&&n!=""&&n.length>0))for(i=0;i<n.length;i++)n[i].href.indexOf("login")>-1&&(n[i].onclick=function(){BLUE_MOODLE.ClearLocalStorage()});if(t=document.getElementsByClassName("logininfo"),t!=null&&t!="")for(i=0;i<t.length;i++)if(n=t[i].getElementsByTagName("a"),n!=null&&n!=""&&n.length>0)for(j=0;j<n.length;j++)n[j].href.indexOf("login")>-1&&(n[j].onclick=function(){BLUE_MOODLE.ClearLocalStorage()})},BlockOtherLinksInCourse:function(){var r=document.getElementById("block-region-side-pre"),u=BLUE_MOODLE.GetAdminSettingFromLocal(),i,n,t;if(r!=null)if(i=r.querySelectorAll("a[href='"+BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id="+localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)+"']"),i!=null&&i.length>0){if(n=i[0].parentElement.parentElement.getElementsByTagName("a"),n!=null&&n.length>0)for(t=0;t<n.length;t++)n[t].innerText.toLowerCase()!=u.ToolName.toLowerCase()&&(n[t].onclick=function(){return BLUE_MOODLE.DisableOnClickInternal()},n[t].href="javascript:void(0);")}else if(i=r.querySelectorAll("a[href='"+BLUE_MOODLE_SETUP.moodleAPI+"/course/view.php?id="+localStorage.getItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE)+"']"),i!=null&&i.length>0&&(n=i[0].parentElement.parentElement.getElementsByTagName("a"),n!=null&&n.length>0))for(t=0;t<n.length;t++)n[t].innerText.toLowerCase()!=u.ToolName.toLowerCase()&&(n[t].onclick=function(){return BLUE_MOODLE.DisableOnClickInternal()},n[t].href="javascript:void(0);")},DisableOnClickInternal:function(n){var t="",r,i;if(t=n?window.location.href.indexOf("/course/view.php?id=")>-1?localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE):"":localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_BLOCKPOPUP_MOODLE),t!=undefined&&t!=null&&t!="")for(r=BLUE_MOODLE.htmlToElements(t),i=0;i<r.length;i++)document.body.appendChild(r[i])},htmlToElements:function(n){var t=document.createElement("template");return t.innerHTML=n,"content"in document.createElement("template")?t.content.childNodes:t.childNodes},CreateCourseBlockPopup:function(){var e=BLUE_MOODLE.getParameter("id"),l=!1,u,h,o,c,f,a,t,i,r,n,s;if(window.location.href.indexOf("mod/lti/view.php?id=")>-1&&(e=null,l=!0,u=JSON.parse(localStorage.getItem(BLUE_MOODLE.localConstant.COURSE_TOOLDETAIL_LIST_MOODLE)),u!=null&&u.length>0))for(n=0;n<u.length;n++)if(u[n].ToolUrl==window.location.href){e=u[n].CourseId;break}if(localStorage.setItem(BLUE_MOODLE.localConstant.CURRENT_COURSEID_MOODLE,e),h=localStorage.getItem(BLUE_MOODLE.localConstant.USER_DETAILS_MOODLE),h!=null&&e!=null){if(o=document.getElementsByClassName("type_siteadmin"),c=document.getElementsByTagName("html")[0].getAttribute("lang"),o!=undefined&&o!=null&&o!=[]&&o.length>0||l||BLUE_MOODLE.ShowLoader("student"),f=new XMLHttpRequest,f.open("GET",BLUE_MOODLE_SETUP.appAPI+"/api/Moodle/GetSeriousTaskDetails?studentID="+h+"&courseIDs="+e+"&language="+c+"&isLoginPopup=false",!1),f.setRequestHeader("Accept","application/json"),f.setRequestHeader("CONSUMERID",BLUE_MOODLE_SETUP.consumerID),f.send(),a=JSON.parse(f.response),t=a.MoodleSeriousTaskList,t!=undefined&&t!=null&&t.length>0){for(i="",BLUE_MOODLE.HideLoader(),r=BLUE_MOODLE.GetAdminSettingFromLocal(),i+='<table style="font-size:13px;width:100%" role="presentation">',n=0;n<t.length;n++){var v=t[n].DueDate,y=new Date(v.substring(0,10)+"T00:00"),p=y.toLocaleDateString(c,BLUE_MOODLE.localConstant.DATE_FORMAT),w=t[n].Name.substring(0,35)+"...";i+='<tr><td style="width:250px;"><a title = "'+t[n].Name+'" style="cursor:pointer;color:#0099b6;text-decoration:underline;" ';i+=r.LaunchNewTab?'href="'+t[n].Link+'" target="_blank" onclick="BLUE_MOODLE.CloseCoursePopup();">':'href="#" onclick="BLUE_MOODLE.NavigateToTask(\''+t[n].Link+"');\" >";i+=w+'<\/a><\/td><td style="text-align:right;"> '+r.DueLabel+" "+p+"<\/td><\/tr>"}return i+="<\/table>",s="",s+='<div style="text-align:center;">',s+='<input type="button" value="'+r.BlockingButtonLabel+'" title="'+r.BlockingButtonLabel+'" style="white-space: normal;" onclick="BLUE_MOODLE.CloseCoursePopup();" id="btnDoneLater"  />',s+="<\/div>",BLUE_MOODLE.CommonPopUp("dvPending_Task",r.LogoURL,r.BlockingMessage,s,i)}return BLUE_MOODLE.HideLoader(),""}return""},getQueryString:function(n,t){var r=new RegExp("[?&]"+n+"=([^&#]*)","i"),i=r.exec(t);return i?i[1]:null}};(document.referrer.toLowerCase().indexOf("login/index.php")!=-1||window.location.href.toLowerCase().indexOf("login/index.php")!=-1||window.location.href.toLowerCase().indexOf("login.php")!=-1||document.referrer!=""&&document.referrer.toLowerCase().indexOf(window.location.host)==-1)&&BLUE_MOODLE.ClearLocalStorage();window.addEventListener?window.addEventListener("load",BlueMoodleOnload,!1):window.attachEvent?window.attachEvent("onload",BlueMoodleOnload):window.onload=BlueMoodleOnload;